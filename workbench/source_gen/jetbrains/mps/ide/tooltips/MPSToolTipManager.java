package jetbrains.mps.ide.tooltips;

/*Generated by MPS */

import com.intellij.openapi.components.ApplicationComponent;
import java.awt.event.MouseMotionListener;
import java.awt.event.MouseMotionAdapter;
import java.awt.event.MouseEvent;
import org.jetbrains.annotations.NonNls;
import org.jetbrains.annotations.NotNull;
import java.awt.Component;
import javax.swing.JComponent;
import java.awt.Point;
import java.awt.Frame;
import org.apache.commons.lang.ObjectUtils;
import javax.swing.SwingUtilities;
import com.intellij.openapi.application.ApplicationManager;

public class MPSToolTipManager implements ApplicationComponent {
  private MouseMotionListener myListener = new MouseMotionAdapter() {
    @Override
    public void mouseMoved(MouseEvent p0) {
      MPSToolTipManager.this.mouseMoved(p0);
    }
  };
  private ToolTip myToolTip;

  public MPSToolTipManager() {
  }

  @NonNls
  @NotNull
  public String getComponentName() {
    return "MPSTooltipManager";
  }

  public void disposeComponent() {
  }

  public void initComponent() {
  }

  public void registerComponent(Component component) {
    component.addMouseMotionListener(this.myListener);
  }

  private void mouseMoved(MouseEvent event) {
    JComponent component = (JComponent)event.getComponent();
    Point point = component.getToolTipLocation(event);
    if (point == null) {
      point = event.getPoint();
    }
    String text = component.getToolTipText(event);
    if (text != null && text.length() > 0) {
      this.showToolTip(text, component, point);
    } else {
      this.hideToolTip();
    }
  }

  public Frame getContainingFrame(Component component) {
    while (component.getParent() != null) {
      component = component.getParent();
    }
    return (Frame)component;
  }

  public void showToolTip(ToolTipData data, JComponent component, Point point) {
    if (this.myToolTip != null) {
      if (ObjectUtils.equals(this.myToolTip.getText(), data.getText())) {
        return;
      }
      this.hideToolTip();
    }
    this.myToolTip = new ToolTip();
    Frame frame = this.getContainingFrame(component);
    SwingUtilities.convertPointToScreen(point, component);
    this.myToolTip.show(frame, point, data);
  }

  public void showToolTip(String text, JComponent component, Point point) {
    if (this.myToolTip != null) {
      if (ObjectUtils.equals(this.myToolTip.getText(), text)) {
        return;
      }
      this.hideToolTip();
    }
    if (text == null) {
      return;
    }
    this.myToolTip = new ToolTip();
    Frame frame = this.getContainingFrame(component);
    SwingUtilities.convertPointToScreen(point, component);
    this.myToolTip.show(frame, point, new ToolTipData(text));
  }

  public void hideToolTip() {
    if (this.myToolTip != null) {
      this.myToolTip.hide();
      this.myToolTip = null;
    }
  }

  public static MPSToolTipManager getInstance() {
    return ApplicationManager.getApplication().getComponent(MPSToolTipManager.class);
  }
}
