package jetbrains.mps.ide.newSolutionDialog;

/*Generated by MPS */

import jetbrains.mps.project.Solution;
import jetbrains.mps.vfs.IFile;
import jetbrains.mps.project.MPSProject;
import jetbrains.mps.project.structure.modules.SolutionDescriptor;
import java.util.UUID;
import jetbrains.mps.project.structure.model.ModelRoot;
import jetbrains.mps.smodel.ModelAccess;
import jetbrains.mps.project.persistence.SolutionDescriptorPersistence;

public class NewModuleUtil {
  public NewModuleUtil() {
  }

  public static Solution createNewSolution(final IFile solutionFile, MPSProject project) {
    final SolutionDescriptor solutionDescriptor = new SolutionDescriptor();
    String fileName = solutionFile.getName();
    solutionDescriptor.setNamespace(fileName.substring(0, fileName.length() - 4));
    solutionDescriptor.setUUID(UUID.randomUUID().toString());
    ModelRoot modelRoot = new ModelRoot();
    modelRoot.setPrefix("");
    modelRoot.setPath(solutionFile.getParent().getPath());
    solutionDescriptor.getModelRoots().add(modelRoot);
    ModelAccess.instance().writeFilesInEDT(new Runnable() {
      public void run() {
        SolutionDescriptorPersistence.saveSolutionDescriptor(solutionFile, solutionDescriptor);
      }
    });
    return project.addProjectSolution(solutionFile);
  }
}
