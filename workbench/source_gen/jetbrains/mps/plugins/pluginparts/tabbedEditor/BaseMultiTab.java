package jetbrains.mps.plugins.pluginparts.tabbedEditor;

/*Generated by MPS */

import jetbrains.mps.ide.tabbedEditor.tabs.BaseMultitabbedTab;
import jetbrains.mps.smodel.SNode;
import jetbrains.mps.util.annotation.Hack;
import java.util.List;
import jetbrains.mps.util.Pair;
import jetbrains.mps.smodel.IOperationContext;
import java.util.ArrayList;
import com.intellij.openapi.project.Project;
import jetbrains.mps.project.IModule;
import jetbrains.mps.project.ModuleContext;
import javax.swing.JOptionPane;
import jetbrains.mps.util.NameUtil;

public abstract class BaseMultiTab extends BaseMultitabbedTab {
  protected BaseMultiTab(SNode baseNode) {
    super(baseNode);
  }

  @Hack
  public List<Pair<SNode, IOperationContext>> tryToLoadNodes() {
    List<Pair<SNode, IOperationContext>> res = new ArrayList<Pair<SNode, IOperationContext>>();
    SNode baseNode = getBaseNode();
    if (baseNode == null) {
      return res;
    }
    for (SNode node : getNodes(baseNode)) {
      if (node == null) {
        continue;
      }
      Project project = getOperationContext().getProject();
      IModule module = node.getModel().getModelDescriptor().getModule();
      IOperationContext context = new ModuleContext(module, project);
      res.add(new Pair<SNode, IOperationContext>(node, context));
    }
    return res;
  }

  protected Pair<SNode, IOperationContext> createLoadableNode(boolean ask, SNode concept) {
    SNode node = createNode(getBaseNode(), ask, concept);
    if (node == null) {
      JOptionPane.showMessageDialog(getComponent(), "Node creation finished with errors.", "Error", JOptionPane.ERROR_MESSAGE);
      return null;
    }
    return new Pair<SNode, IOperationContext>(node, getOperationContext());
  }

  public boolean askCreate() {
    return askCreate(getBaseNode());
  }

  public boolean askCreate(SNode baseNode) {
    String entity = NameUtil.singularize(getTitle());
    return TabHelper.ask("Do you want to create a new " + NameUtil.decapitalize(entity) + "?", "Create New " + entity);
  }

  public abstract String getTitle();

  public abstract String getNullText();

  public abstract List<SNode> getNodes(SNode node);

  public abstract boolean canCreate();

  public abstract SNode createNode(SNode node, boolean ask, SNode concept);
}
