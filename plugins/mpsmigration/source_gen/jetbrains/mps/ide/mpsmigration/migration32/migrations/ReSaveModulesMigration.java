package jetbrains.mps.ide.mpsmigration.migration32.migrations;

/*Generated by MPS */

import jetbrains.mps.migration.global.BaseProjectMigration;
import jetbrains.mps.project.Project;
import org.jetbrains.mps.openapi.module.SModule;
import jetbrains.mps.project.AbstractModule;
import jetbrains.mps.internal.collections.runtime.Sequence;
import jetbrains.mps.internal.collections.runtime.IWhereFilter;
import jetbrains.mps.smodel.MPSModuleRepository;

public class ReSaveModulesMigration extends BaseProjectMigration {
  public static final String ID = "jetbrains.mps.mps33.resaveModules";

  public ReSaveModulesMigration() {
    super(ReSaveModulesMigration.ID);
  }
  @Override
  public String getDescription() {
    return "Re-save all modules";
  }
  @Override
  public boolean doExecute(Project p) {
    Iterable<? extends SModule> modules = p.getModulesWithGenerators();
    for (AbstractModule module : Sequence.fromIterable(modules).ofType(AbstractModule.class).where(new IWhereFilter<AbstractModule>() {
      public boolean accept(AbstractModule it) {
        return !(it.isReadOnly());
      }
    })) {
      module.setChanged();
    }
    MPSModuleRepository.getInstance().saveAll();
    return true;
  }
}
