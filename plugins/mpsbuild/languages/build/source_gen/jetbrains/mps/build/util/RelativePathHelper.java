package jetbrains.mps.build.util;

/*Generated by MPS */

import org.apache.commons.lang.StringUtils;
import jetbrains.mps.util.FileUtil;
import java.io.File;

public class RelativePathHelper {
  private String myBasePath;

  public RelativePathHelper(String basePath) {
    myBasePath = basePath.replace("\\", "/");
  }

  public String makeRelative(String fullPath) throws RelativePathHelper.PathException {
    if (StringUtils.isEmpty(fullPath)) {
      return "";
    }
    String normalized = FileUtil.getAbsolutePath(fullPath).replace("\\", "/");
    try {
      return FileUtil.getRelativePath(normalized, myBasePath, "/");
    } catch (Exception ex) {
      throw new RelativePathHelper.PathException(ex, ex.getMessage());
    }
  }

  public String makeAbsolute(String shortPath) throws RelativePathHelper.PathException {
    if (StringUtils.isEmpty(shortPath)) {
      return myBasePath;
    }
    shortPath = shortPath.replace("\\", "/");
    if (shortPath.startsWith("./")) {
      shortPath = shortPath.substring(2);
    }
    File res = new File(myBasePath, shortPath);
    try {
      return res.getCanonicalPath();
    } catch (Exception ex) {
      throw new RelativePathHelper.PathException(ex, ex.getMessage());
    }
  }

  public String getBasePath() {
    return myBasePath;
  }

  public static class PathException extends Exception {
    public PathException(Throwable cause, String message) {
      super(message, cause);
    }
  }
}
