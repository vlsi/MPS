package jetbrains.mps.baseLanguage.math.typesystem;

/*Generated by MPS */

import jetbrains.mps.lang.typesystem.dependencies.InferenceMethod;
import jetbrains.mps.typesystem.inference.TypeCheckingContext;
import java.util.List;
import jetbrains.mps.smodel.SNode;
import jetbrains.mps.internal.collections.runtime.ListSequence;
import jetbrains.mps.smodel.SModelUtil_new;
import jetbrains.mps.lang.smodel.generator.smodelAdapter.SPropertyOperations;
import jetbrains.mps.intentions.BaseIntentionProvider;
import jetbrains.mps.typesystem.inference.EquationInfo;
import jetbrains.mps.lang.smodel.generator.smodelAdapter.SLinkOperations;
import java.util.ArrayList;
import jetbrains.mps.typesystem.inference.IErrorTarget;
import jetbrains.mps.typesystem.inference.NodeErrorTarget;

public class DimensionUtil {
  @InferenceMethod
  public static void checkDim(final TypeCheckingContext typeCheckingContext, final List<SNode> components, final int n, final List<SNode> types, final boolean row, final SNode node) {
    if (n == ListSequence.fromList(components).count()) {
      final SNode T_typevar_757772128652074250 = typeCheckingContext.createNewRuntimeTypesVariable();
      int s = 0;
      int f = 0;
      boolean cbd = true;
      boolean cbc = true;
      for (SNode type : ListSequence.fromList(types)) {
        do {
          SNode matchedNode_4 = type;
          {
            boolean matches_11 = false;
            {
              SNode matchingNode_11 = type;
              if (matchingNode_11 != null) {
                matches_11 = SModelUtil_new.isAssignableConcept(matchingNode_11.getConceptFqName(), "jetbrains.mps.baseLanguage.math.structure.MatrixType");
              }
            }
            if (matches_11) {
              if (row) {
                if (SPropertyOperations.getInteger(matchedNode_4, "rows") == 0) {
                  cbd = false;
                }
                if (SPropertyOperations.getInteger(matchedNode_4, "columns") == 0) {
                  cbc = false;
                }
                if (cbd && f != 0 && f != SPropertyOperations.getInteger(matchedNode_4, "rows")) {
                  reportError(typeCheckingContext, node);
                }
                if (f == 0) {
                  f = SPropertyOperations.getInteger(matchedNode_4, "rows");
                }
                if (s == 0) {
                  s = SPropertyOperations.getInteger(matchedNode_4, "columns");
                } else {
                  s += SPropertyOperations.getInteger(matchedNode_4, "columns");
                }
              } else {
                if (SPropertyOperations.getInteger(matchedNode_4, "columns") == 0) {
                  cbd = false;
                }
                if (SPropertyOperations.getInteger(matchedNode_4, "rows") == 0) {
                  cbc = false;
                }
                if (cbd && f != 0 && f != SPropertyOperations.getInteger(matchedNode_4, "columns")) {
                  reportError(typeCheckingContext, node);
                }
                if (f == 0) {
                  f = SPropertyOperations.getInteger(matchedNode_4, "columns");
                }
                if (s == 0) {
                  s = SPropertyOperations.getInteger(matchedNode_4, "rows");
                } else {
                  s += SPropertyOperations.getInteger(matchedNode_4, "rows");
                }
              }
              {
                SNode _nodeToCheck_1029348928467 = null;
                BaseIntentionProvider intentionProvider = null;
                EquationInfo info = new EquationInfo(_nodeToCheck_1029348928467, null, "r:47d0f24b-df34-4ea0-aa7e-7c2eb0f88f31(jetbrains.mps.baseLanguage.math.typesystem)", "757772128652074322", 0, intentionProvider);
                typeCheckingContext.createLessThanInequation((SNode)SLinkOperations.getTarget(matchedNode_4, "elementType", true), (SNode)typeCheckingContext.getEquationManager().getRepresentator(T_typevar_757772128652074250), false, info);
              }
              break;
            }
          }
          {
            boolean matches_12 = false;
            {
              SNode matchingNode_12 = type;
              if (matchingNode_12 != null) {
                matches_12 = SModelUtil_new.isAssignableConcept(matchingNode_12.getConceptFqName(), "jetbrains.mps.baseLanguage.math.structure.VectorType");
              }
            }
            if (matches_12) {
              if (row) {
                if (SPropertyOperations.getInteger(matchedNode_4, "height") == 0) {
                  cbd = false;
                }
                if (cbd && f != 0 && f != SPropertyOperations.getInteger(matchedNode_4, "height")) {
                  reportError(typeCheckingContext, node);
                }
                if (f == 0) {
                  f = SPropertyOperations.getInteger(matchedNode_4, "height");
                }
                if (s == 0) {
                  s = 1;
                } else {
                  s += 1;
                }
              } else {
                if (SPropertyOperations.getInteger(matchedNode_4, "height") == 0) {
                  cbc = false;
                }
                if (cbd && f != 0 && f != 1) {
                  reportError(typeCheckingContext, node);
                }
                if (f == 0) {
                  f = 1;
                }
                if (s == 0) {
                  s = SPropertyOperations.getInteger(matchedNode_4, "height");
                } else {
                  s += SPropertyOperations.getInteger(matchedNode_4, "height");
                }
              }
              {
                SNode _nodeToCheck_1029348928467 = null;
                BaseIntentionProvider intentionProvider = null;
                EquationInfo info = new EquationInfo(_nodeToCheck_1029348928467, null, "r:47d0f24b-df34-4ea0-aa7e-7c2eb0f88f31(jetbrains.mps.baseLanguage.math.typesystem)", "757772128652075446", 0, intentionProvider);
                typeCheckingContext.createLessThanInequation((SNode)SLinkOperations.getTarget(matchedNode_4, "elementType", true), (SNode)typeCheckingContext.getEquationManager().getRepresentator(T_typevar_757772128652074250), false, info);
              }
              break;
            }
          }
          {
            SNode _nodeToCheck_1029348928467 = null;
            BaseIntentionProvider intentionProvider = null;
            EquationInfo info = new EquationInfo(_nodeToCheck_1029348928467, null, "r:47d0f24b-df34-4ea0-aa7e-7c2eb0f88f31(jetbrains.mps.baseLanguage.math.typesystem)", "757772128652104638", 0, intentionProvider);
            typeCheckingContext.createLessThanInequation((SNode)type, (SNode)typeCheckingContext.getEquationManager().getRepresentator(T_typevar_757772128652074250), false, info);
          }
          if (row) {
            if (cbd && f != 0 && f != 1) {
              reportError(typeCheckingContext, node);
            }
            if (f == 0) {
              f = 1;
            }
            if (s == 0) {
              s = 1;
            } else {
              s += 1;
            }
          } else {
            if (cbd && f != 0 && f != 1) {
              reportError(typeCheckingContext, node);
            }
            if (f == 0) {
              f = 1;
            }
            if (s == 0) {
              s = 1;
            } else {
              s += 1;
            }
          }
        } while(false);
      }
      SNode result = MathTypeUtil.qMatrix(typeCheckingContext.getEquationManager().getRepresentator(T_typevar_757772128652074250));
      if (row) {
        if (cbc) {
          SPropertyOperations.set(result, "columns", "" + s);
        }
        if (cbd) {
          SPropertyOperations.set(result, "rows", "" + f);
        }
      } else {
        if (cbc) {
          SPropertyOperations.set(result, "rows", "" + s);
        }
        if (cbd) {
          SPropertyOperations.set(result, "columns", "" + f);
        }
      }
      if (SPropertyOperations.getInteger(result, "columns") == 1) {
        {
          SNode _nodeToCheck_1029348928467 = node;
          BaseIntentionProvider intentionProvider = null;
          EquationInfo info = new EquationInfo(_nodeToCheck_1029348928467, null, "r:47d0f24b-df34-4ea0-aa7e-7c2eb0f88f31(jetbrains.mps.baseLanguage.math.typesystem)", "6389121991274973498", 0, intentionProvider);
          typeCheckingContext.createEquation((SNode)typeCheckingContext.typeOf(_nodeToCheck_1029348928467, "r:47d0f24b-df34-4ea0-aa7e-7c2eb0f88f31(jetbrains.mps.baseLanguage.math.typesystem)", "6389121991274973494", true), (SNode)new _Quotations.QuotationClass_31().createNode(typeCheckingContext.getEquationManager().getRepresentator(T_typevar_757772128652074250), "" + SPropertyOperations.getInteger(result, "rows"), typeCheckingContext), info);
        }
      } else {
        {
          SNode _nodeToCheck_1029348928467 = node;
          BaseIntentionProvider intentionProvider = null;
          EquationInfo info = new EquationInfo(_nodeToCheck_1029348928467, null, "r:47d0f24b-df34-4ea0-aa7e-7c2eb0f88f31(jetbrains.mps.baseLanguage.math.typesystem)", "6389121991274973487", 0, intentionProvider);
          typeCheckingContext.createEquation((SNode)typeCheckingContext.typeOf(_nodeToCheck_1029348928467, "r:47d0f24b-df34-4ea0-aa7e-7c2eb0f88f31(jetbrains.mps.baseLanguage.math.typesystem)", "6389121991274973491", true), (SNode)result, info);
        }
      }
    } else {
      {
        final SNode t1 = typeCheckingContext.typeOf(ListSequence.fromList(components).getElement(n), "r:47d0f24b-df34-4ea0-aa7e-7c2eb0f88f31(jetbrains.mps.baseLanguage.math.typesystem)", "757772128652013457", true);
        typeCheckingContext.whenConcrete(t1, new Runnable() {
          public void run() {
            List<SNode> types2 = new ArrayList<SNode>();
            ListSequence.fromList(types2).addSequence(ListSequence.fromList(types));
            ListSequence.fromList(types2).addElement(typeCheckingContext.getEquationManager().getRepresentator(t1));
            checkDim(typeCheckingContext, components, n + 1, types2, row, node);
          }
        }, "r:47d0f24b-df34-4ea0-aa7e-7c2eb0f88f31(jetbrains.mps.baseLanguage.math.typesystem)", "757772128651891776", false, false);
      }
    }
  }

  @InferenceMethod
  public static void reportError(final TypeCheckingContext typeCheckingContext, SNode n) {
    {
      BaseIntentionProvider intentionProvider = null;
      IErrorTarget errorTarget = new NodeErrorTarget();
      typeCheckingContext.reportTypeError(n, "Invalid matrix dimensions", "r:47d0f24b-df34-4ea0-aa7e-7c2eb0f88f31(jetbrains.mps.baseLanguage.math.typesystem)", "7676695779583019339", intentionProvider, errorTarget);
    }
  }

  public static int dimr(SNode t) {
    do {
      SNode matchedNode_5 = t;
      {
        boolean matches_13 = false;
        {
          SNode matchingNode_13 = t;
          if (matchingNode_13 != null) {
            matches_13 = SModelUtil_new.isAssignableConcept(matchingNode_13.getConceptFqName(), "jetbrains.mps.baseLanguage.math.structure.MatrixType");
          }
        }
        if (matches_13) {
          return SPropertyOperations.getInteger(matchedNode_5, "rows");
        }
      }
      {
        boolean matches_14 = false;
        {
          SNode matchingNode_14 = t;
          if (matchingNode_14 != null) {
            matches_14 = SModelUtil_new.isAssignableConcept(matchingNode_14.getConceptFqName(), "jetbrains.mps.baseLanguage.math.structure.VectorType");
          }
        }
        if (matches_14) {
          return SPropertyOperations.getInteger(matchedNode_5, "height");
        }
      }
      return 0;
    } while(false);
  }

  public static int dimc(SNode t) {
    do {
      SNode matchedNode_6 = t;
      {
        boolean matches_15 = false;
        {
          SNode matchingNode_15 = t;
          if (matchingNode_15 != null) {
            matches_15 = SModelUtil_new.isAssignableConcept(matchingNode_15.getConceptFqName(), "jetbrains.mps.baseLanguage.math.structure.MatrixType");
          }
        }
        if (matches_15) {
          return SPropertyOperations.getInteger(matchedNode_6, "columns");
        }
      }
      {
        boolean matches_16 = false;
        {
          SNode matchingNode_16 = t;
          if (matchingNode_16 != null) {
            matches_16 = SModelUtil_new.isAssignableConcept(matchingNode_16.getConceptFqName(), "jetbrains.mps.baseLanguage.math.structure.VectorType");
          }
        }
        if (matches_16) {
          return 1;
        }
      }
      return 0;
    } while(false);
  }
}
