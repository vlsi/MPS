package jetbrains.mps.lang.editor.intentions;

/*Generated by MPS */

import jetbrains.mps.smodel.SNode;
import jetbrains.mps.lang.editor.behavior.AbstractComponent_Behavior;
import jetbrains.mps.smodel.action.SNodeFactoryOperations;
import jetbrains.mps.lang.smodel.generator.smodelAdapter.SLinkOperations;
import jetbrains.mps.internal.collections.runtime.ListSequence;
import jetbrains.mps.lang.structure.behavior.AbstractConceptDeclaration_Behavior;
import jetbrains.mps.lang.smodel.generator.smodelAdapter.SNodeOperations;
import jetbrains.mps.lang.smodel.generator.smodelAdapter.SPropertyOperations;
import jetbrains.mps.lang.structure.behavior.LinkDeclaration_Behavior;
import jetbrains.mps.lang.smodel.generator.smodelAdapter.SConceptOperations;
import jetbrains.mps.util.NameUtil;

public class DefaultEditorBuilder {
  public DefaultEditorBuilder() {
  }

  public static void buildDefaultEditor(SNode node) {
    SNode conceptDeclaration = AbstractComponent_Behavior.call_getConceptDeclaration_7055725856388417603(node);
    SNode collection = SNodeFactoryOperations.createNewNode("jetbrains.mps.lang.editor.structure.CellModel_Collection", null);
    SLinkOperations.setTarget(collection, "cellLayout", SNodeFactoryOperations.createNewNode("jetbrains.mps.lang.editor.structure.CellLayout_Indent", null), true);
    for (SNode property : ListSequence.fromList(AbstractConceptDeclaration_Behavior.call_getPropertyDeclarations_1213877394546(conceptDeclaration))) {
      if (SNodeOperations.getParent(property) != SNodeOperations.getNode("r:00000000-0000-4000-0000-011c89590288(jetbrains.mps.lang.core.structure)", "1133920641626")) {
        DefaultEditorBuilder.addName(SPropertyOperations.getString(property, "name"), collection);
        SNode propertyCell = SNodeFactoryOperations.createNewNode("jetbrains.mps.lang.editor.structure.CellModel_Property", null);
        SLinkOperations.setTarget(propertyCell, "relationDeclaration", property, false);
        DefaultEditorBuilder.makeNewLine(propertyCell);
        ListSequence.fromList(SLinkOperations.getTargets(collection, "childCellModel", true)).addElement(propertyCell);
      }
    }
    for (SNode linkDeclaration : ListSequence.fromList(AbstractConceptDeclaration_Behavior.call_getLinkDeclarations_1213877394480(conceptDeclaration))) {
      DefaultEditorBuilder.addName(SPropertyOperations.getString(linkDeclaration, "role"), collection);
      if (SPropertyOperations.hasValue(linkDeclaration, "metaClass", "aggregation", "reference")) {
        if (LinkDeclaration_Behavior.call_isSingular_1213877254557(linkDeclaration)) {
          SNode linkCell = SNodeFactoryOperations.createNewNode("jetbrains.mps.lang.editor.structure.CellModel_RefNode", null);
          SLinkOperations.setTarget(linkCell, "relationDeclaration", linkDeclaration, false);
          DefaultEditorBuilder.makeNewLine(linkCell);
          ListSequence.fromList(SLinkOperations.getTargets(collection, "childCellModel", true)).addElement(linkCell);
        } else {
          SNode linkCell = SNodeFactoryOperations.createNewNode("jetbrains.mps.lang.editor.structure.CellModel_RefNodeList", null);
          SLinkOperations.setTarget(linkCell, "relationDeclaration", linkDeclaration, false);
          SLinkOperations.setTarget(linkCell, "cellLayout", SNodeFactoryOperations.createNewNode("jetbrains.mps.lang.editor.structure.CellLayout_Indent", null), true);
          DefaultEditorBuilder.makeNewLine(linkCell);
          DefaultEditorBuilder.addClassItem(linkCell, SConceptOperations.findConceptDeclaration("jetbrains.mps.lang.editor.structure.IndentLayoutIndentStyleClassItem"));
          DefaultEditorBuilder.addClassItem(linkCell, SConceptOperations.findConceptDeclaration("jetbrains.mps.lang.editor.structure.IndentLayoutNewLineChildrenStyleClassItem"));
          ListSequence.fromList(SLinkOperations.getTargets(collection, "childCellModel", true)).addElement(linkCell);
        }
      } else {
        if (LinkDeclaration_Behavior.call_isSingular_1213877254557(linkDeclaration)) {
          SNode linkCell = SNodeFactoryOperations.createNewNode("jetbrains.mps.lang.editor.structure.CellModel_RefCell", null);
          SLinkOperations.setTarget(linkCell, "relationDeclaration", linkDeclaration, false);
          SLinkOperations.setTarget(linkCell, "editorComponent", createInlineEditorComponent(SLinkOperations.getTarget(linkDeclaration, "target", false)), true);
          DefaultEditorBuilder.makeNewLine(linkCell);
          ListSequence.fromList(SLinkOperations.getTargets(collection, "childCellModel", true)).addElement(linkCell);
        }
      }
    }
    SLinkOperations.setTarget(node, "cellModel", collection, true);
  }

  public static SNode createInlineEditorComponent(SNode concept) {
    SNode inline = SNodeFactoryOperations.createNewNode("jetbrains.mps.lang.editor.structure.InlineEditorComponent", null);
    SNode propertyCell = SNodeFactoryOperations.createNewNode("jetbrains.mps.lang.editor.structure.CellModel_Property", null);
    SLinkOperations.setTarget(propertyCell, "relationDeclaration", AbstractConceptDeclaration_Behavior.call_findPropertyDeclaration_1219835742593(concept, "name"), false);
    SLinkOperations.setTarget(inline, "cellModel", propertyCell, true);
    return inline;
  }

  private static void makeNewLine(SNode propertyCell) {
    SNode classItem = SNodeFactoryOperations.createNewNode("jetbrains.mps.lang.editor.structure.IndentLayoutNewLineStyleClassItem", null);
    SPropertyOperations.set(classItem, "flag", "" + true);
    ListSequence.fromList(SLinkOperations.getTargets(propertyCell, "styleItem", true)).addElement(classItem);
  }

  private static void addName(String name, SNode collection) {
    SNode nameCell = SNodeFactoryOperations.createNewNode("jetbrains.mps.lang.editor.structure.CellModel_Constant", null);
    SPropertyOperations.set(nameCell, "text", name);
    ListSequence.fromList(SLinkOperations.getTargets(collection, "childCellModel", true)).addElement(nameCell);
  }

  private static void addClassItem(SNode linkCell, SNode concept) {
    SNode classItem = SNodeFactoryOperations.createNewNode(NameUtil.nodeFQName(concept), null);
    SPropertyOperations.set(classItem, "flag", "" + true);
    ListSequence.fromList(SLinkOperations.getTargets(linkCell, "styleItem", true)).addElement(classItem);
  }
}
