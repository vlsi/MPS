package jetbrains.mps.samples.customAspect.documentation.plugin;

/*Generated by MPS */

import jetbrains.mps.smodel.structure.Extension;
import jetbrains.mps.smodel.language.LanguageAspectDescriptor;
import org.jetbrains.annotations.NotNull;
import java.util.Collection;
import org.jetbrains.mps.openapi.model.SModel;
import org.jetbrains.mps.openapi.module.SModule;
import jetbrains.mps.internal.collections.runtime.Sequence;
import jetbrains.mps.internal.collections.runtime.IWhereFilter;
import org.jetbrains.mps.openapi.language.SLanguage;
import jetbrains.mps.internal.collections.runtime.ListSequence;
import java.util.ArrayList;
import jetbrains.mps.smodel.adapter.structure.MetaAdapterFactory;
import jetbrains.mps.smodel.adapter.ids.MetaIdFactory;
import org.jetbrains.annotations.Nullable;
import jetbrains.mps.smodel.language.LanguageAspectGenerator;
import javax.swing.Icon;
import jetbrains.mps.internal.collections.runtime.CollectionSequence;
import jetbrains.mps.smodel.Language;
import org.jetbrains.mps.openapi.persistence.ModelRoot;
import jetbrains.mps.smodel.ModelRootUtil;
import jetbrains.mps.project.SModuleOperations;
import jetbrains.mps.util.IconUtil;

public class Extension_LanguageAspectsEP_ extends Extension.Default<LanguageAspectDescriptor> {
  public Extension_LanguageAspectsEP_() {
    super("jetbrains.mps.lang.customAspect.LanguageAspectsEP");
  }
  public LanguageAspectDescriptor get() {
    return new LanguageAspectDescriptor() {
      public String getPresentableAspectName() {
        return "documentation";
      }
      @NotNull
      public Collection<SModel> getAspectModels(final SModule language) {
        Iterable<SModel> allModels = language.getModels();
        return Sequence.fromIterable(allModels).where(new IWhereFilter<SModel>() {
          public boolean accept(SModel it) {
            String fullName = it.getModelName();
            return eq_xchw4o_a0b0a0a0a0a0b0b0a0a0b(fullName, language.getModuleName() + "." + getPresentableAspectName());
          }
        }).ofType(SModel.class).toListSequence();
      }
      @NotNull
      public Collection<SLanguage> getMainLanguages() {
        return ListSequence.fromListAndArray(new ArrayList<SLanguage>(), MetaAdapterFactory.getLanguage(MetaIdFactory.langId(0x22916f45e98f4433L, 0x9c1b1b382cf5bd8dL), "jetbrains.mps.samples.customAspect.documentation"));
      }
      @Nullable
      public LanguageAspectGenerator getGenerator() {
        return null;
      }
      @Nullable
      public Icon getIcon() {
        return ICON;
      }






      public boolean canCreate(SModule language) {
        return CollectionSequence.fromCollection(getAspectModels(language)).isEmpty();
      }

      public void create(SModule language) {
        Language l = ((Language) language);
        SModel structureModel = l.getStructureModelDescriptor();
        ModelRoot modelRoot;
        if (structureModel == null) {
          modelRoot = l.getModelRoots().iterator().next();
        } else {
          modelRoot = ModelRootUtil.getModelRoot(structureModel);
        }
        SModuleOperations.createModelWithAdjustments(l.getModuleName() + "." + getPresentableAspectName(), modelRoot);
      }

      private final Icon ICON = IconUtil.getIcon("documentation.png");


    };
  }
  private static boolean eq_xchw4o_a0b0a0a0a0a0b0b0a0a0b(Object a, Object b) {
    return (a != null ? a.equals(b) : a == b);
  }
}
